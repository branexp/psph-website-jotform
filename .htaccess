# --- Canonical: HTTPS + non-www for psph.org ---
RewriteEngine On
Options -MultiViews
RewriteCond %{HTTPS} !=on [OR]
RewriteCond %{HTTP_HOST} ^www\.psph\.org$ [NC]
RewriteRule ^ https://psph.org%{REQUEST_URI} [R=301,L]

# --- Remove trailing slashes (except root) ---
RewriteCond %{REQUEST_URI} !^/$
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.+?)/$ /$1 [R=301,L]

# --- Redirect .html extension to clean URLs ---
RewriteCond %{THE_REQUEST} \s/+(.+?)\.html[\s?] [NC]
RewriteRule ^ /%1 [R=301,L]

# --- Short-circuit actual files/dirs (keeps PHP endpoints reachable) ---
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# --- Serve extensionless URLs as .html ---
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME}.html -f
RewriteRule ^(.+?)$ $1.html [L]

# --- Lightweight security headers ---
<IfModule mod_headers.c>
  Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
  Header set X-Content-Type-Options "nosniff"
  Header set Referrer-Policy "strict-origin-when-cross-origin"
  Header set Content-Security-Policy "default-src 'self'; img-src 'self' data: https:; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com data:; script-src 'self' https://form.jotform.com https://cdn.jotfor.ms https://js.jotform.com; connect-src 'self' https://api.jotform.com; frame-src https://form.jotform.com;"
</IfModule>